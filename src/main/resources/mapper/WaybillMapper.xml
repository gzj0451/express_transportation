<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gzj.express_transportation.dao.WaybillMapper">
    <resultMap id="BaseResultMap" type="com.gzj.express_transportation.entity.Waybill">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <result column="waybill_no" jdbcType="VARCHAR" property="waybillNo"/>
        <result column="weight" jdbcType="VARCHAR" property="weight"/>
        <result column="price" jdbcType="VARCHAR" property="price"/>
        <result column="kdy_id" jdbcType="VARCHAR" property="kdyId"/>
        <result column="kdy_name" jdbcType="VARCHAR" property="kdyName"/>
        <result column="kdy_phone" jdbcType="VARCHAR" property="kdyPhone"/>
        <result column="j_name" jdbcType="VARCHAR" property="jName"/>
        <result column="j_phone" jdbcType="VARCHAR" property="jPhone"/>
        <result column="j_address" jdbcType="VARCHAR" property="jAddress"/>
        <result column="s_name" jdbcType="VARCHAR" property="sName"/>
        <result column="s_phone" jdbcType="VARCHAR" property="sPhone"/>
        <result column="s_address" jdbcType="VARCHAR" property="sAddress"/>
        <result column="w_status" jdbcType="VARCHAR" property="wStatus"/>
    </resultMap>
    <update id="updateByPrimaryKey" parameterType="com.gzj.express_transportation.entity.Waybill">
        update waybill
        <set>
            <if test="weight != null and weight != ''">
                weight = #{weight},
            </if>
            <if test="price != null and price != ''">
                price = #{price},
            </if>
            <if test="kdyId != null and kdyId != ''">
                kdy_id = #{kdyId},
            </if>
            <if test="kdyName != null and kdyName != ''">
                kdy_name = #{kdyId},
            </if>
            <if test="kdyPhone != null and kdyPhone != ''">
                kdy_phone = #{kdyPhone},
            </if>
            <if test="jName != null and jName != ''">
                j_name = #{jName},
            </if>
            <if test="jPhone != null and jPhone != ''">
                j_phone = #{jPhone},
            </if>
            <if test="jAddress != null and jAddress != ''">
                j_address = #{jAddress},
            </if>
            <if test="sName != null and sName != ''">
                s_name = #{sName},
            </if>
            <if test="sPhone != null and sPhone != ''">
                s_phone = #{sPhone},
            </if>
            <if test="sAddress != null and sAddress != ''">
                s_address = #{sAddress},
            </if>
            <if test="wStatus != null and wStatus != ''">
                w_status = #{wStatus},
            </if>
        </set>
        where waybill_no = #{waybillNo}
    </update>
    <delete id="deleteByPrimaryKey">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from waybill
        where waybill_no = #{id}
    </delete>
    <insert id="insert" parameterType="com.gzj.express_transportation.entity.Waybill">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into waybill (waybill_no, weight, price,
        kdy_id, kdy_name, kdy_phone,
        j_name, j_phone, j_address,
        s_name, s_phone, s_address,
        w_status)
        values (#{waybillNo,jdbcType=VARCHAR}, #{weight,jdbcType=VARCHAR}, #{price,jdbcType=VARCHAR},
        #{kdyId,jdbcType=VARCHAR}, #{kdyName,jdbcType=VARCHAR}, #{kdyPhone,jdbcType=VARCHAR},
        #{jName,jdbcType=VARCHAR}, #{jPhone,jdbcType=VARCHAR}, #{jAddress,jdbcType=VARCHAR},
        #{sName,jdbcType=VARCHAR}, #{sPhone,jdbcType=VARCHAR}, #{sAddress,jdbcType=VARCHAR},
        '待揽收')
    </insert>
    <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select waybill_no, weight, price, kdy_id, kdy_name, kdy_phone, j_name, j_phone, j_address,
        s_name, s_phone, s_address, w_status
        from waybill
        where waybill_no = #{id}
    </select>
    <select id="selectAll" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select waybill_no, weight, price, kdy_id, kdy_name, kdy_phone, j_name, j_phone, j_address,
        s_name, s_phone, s_address, w_status
        from waybill
    </select>
    <select id="count" resultType="java.lang.Integer">
        select count(*)
        from waybill
        <where>
            <if test="waybillNo != null and waybillNo != ''">
                and waybill_no like concat('%',#{waybillNo},'%')
            </if>
            <if test="wStatus != null and wStatus != ''">
                and w_status like concat('%', #{wStatus},'%')
            </if>
            <if test="role == '快递员'">
                and kdy_phone = #{phone}
            </if>
            <if test="role == '客户'">
                and (s_phone = #{phone} or j_phone = #{phone})
            </if>

        </where>
    </select>
    <select id="selectPage" resultType="com.gzj.express_transportation.entity.Waybill">
        select waybill_no, weight, price, kdy_id, kdy_name, kdy_phone, j_name, j_phone, j_address,
        s_name, s_phone, s_address, w_status
        from waybill
        <where>
            <if test="role != '快递员' and waybillNo != null and waybillNo != ''">
                and waybill_no like concat('%',#{waybillNo},'%')
            </if>
            <if test="wStatus != null and wStatus != ''">
                and w_status like concat('%', #{wStatus},'%')
            </if>
            <if test="role == '快递员'">
                and waybill_no like concat('%',#{waybillNo},'%') and (kdy_phone = #{phone} or w_status = "待揽收")
            </if>
            <if test="role == '客户'">
                and (s_phone = #{phone} or j_phone = #{phone})
            </if>
        </where>
    </select>
    <select id="getCount" resultMap="OrdersMap">
        select *,(dls+ysz+ywc) zs from (
            select
                sum(price) as price,
                sum(if(w_status='待揽收',1,0)) as dls,
                sum(if(w_status='运输中',1,0)) as ysz,
                sum(if(w_status='已完成',1,0)) as ywc
                from waybill )a
    </select>
    <resultMap id="OrdersMap" type="com.gzj.express_transportation.entity.Orders">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <result column="dls" jdbcType="VARCHAR" property="dls"/>
        <result column="ysz" jdbcType="VARCHAR" property="ysz"/>
        <result column="ywc" jdbcType="VARCHAR" property="ywc"/>
        <result column="zs" jdbcType="VARCHAR" property="zs"/>
        <result column="price" jdbcType="VARCHAR" property="price"/>
    </resultMap>

</mapper>